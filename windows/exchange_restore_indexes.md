# Восстановление индексов почтовых баз

## Проблема:

Довольно часто возникает ситуация когда рушатся индексы в почтовых базах. Выглядит это следующим образом:
1. Пользователи начинают жаловаться на то что поиск а Outlook работает не правильно или не все письма находятся<br><br>
1. В консоли управления сервером Exchange видим вот такое:

```powershell
[PS] C:\Windows\system32>Get-MailboxDatabaseCopyStatus * | ft -auto

Name                                              Status        CopyQueueLength   ReplayQueueLength   LastInspectedLogTime   ContentIndexState
-------                                             -------        ---------------------  -----------------------   ------------------------    --------------------
MailBoxDatabaseONE\EXCH01      Mounted    0                              0                                                                          Healthy
MailBoxDatabaseTWO\EXCH01   Mounted    0                              0                                                                          FailedAndSuspended
MailBoxDatabaseTHREE\EXCH01  Mounted    0                              0                                                                          Failed

# Все что не "Health" - не нормально
```

<br><br>

## Решение:

<br>Лечение заключается в том что нужно заставить систему перестроить в почтовой базе индексы.<br>

В нашем случае (если нет резервных серверов, нет репликации и т.д.) нужно выполнить следующие действия:<br>

Зайти в оснастку "Управление компьютером"<br>
В разделе управления службами остановить следующие службы: <br>Microsoft Exchange Search <br>Microsoft Exchange Search Host Controller<br><br>
Зайти файловым менеджером в каталог где находится почтовая база и удалить папку индексов (наименование вида 280B22E-4B03-4F08-54B34A9AC12.3.Single)<br><br>
После этого запустить обратно остановленные службы<br><br>
Когда состояние базы в ContentIndexState станет из Crawlind ----> Healthy - переиндексация будет считаться успешной

```diff
! Возможно когда-то столкнусь с такой же проблемой на группе серверов, тогда и добавлю сюда обновление решения с учетом специфики работы группы серверов
```

<br>


### Навигация

[Вернуться в основное меню](../README.md)
<br> [Windows](../windows/README.md)
